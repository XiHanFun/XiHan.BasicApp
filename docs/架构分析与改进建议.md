# XiHan.BasicApp æ¡†æ¶æ¶æ„åˆ†æä¸æ”¹è¿›å»ºè®®

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£å¯¹ XiHan.BasicApp æ¡†æ¶è¿›è¡Œå…¨é¢çš„æ¶æ„åˆ†æï¼Œè¯†åˆ«å½“å‰æ¶æ„çš„ä¼˜åŠ¿ä¸ä¸è¶³ï¼Œå¹¶æä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®ã€‚

**åˆ†ææ—¥æœŸ**: 2026-01-23  
**åˆ†æèŒƒå›´**: åç«¯æ¶æ„ã€æ¨¡å—åŒ–è®¾è®¡ã€DDDå®ç°ã€ä»£ç ç»„ç»‡

---

## ğŸ¯ å½“å‰æ¶æ„æ¦‚è¿°

### æ¶æ„æ¨¡å¼
- **ç±»å‹**: æ¨¡å—åŒ–åˆ†å±‚æ¶æ„ (Modular Layered Architecture)
- **è®¾è®¡æ–¹æ³•**: é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)
- **æŠ€æœ¯æ ˆ**: .NET Core, ASP.NET Core, SqlSugar ORM
- **åŸºç¡€æ¡†æ¶**: XiHan.Framework v2.2.0-alpha.1 (è‡ªç ”æ¡†æ¶)

### é¡¹ç›®ç»“æ„
```
backend/src/
â”œâ”€â”€ framework/           # æ¡†æ¶å±‚
â”‚   â”œâ”€â”€ XiHan.BasicApp.Core           # æ ¸å¿ƒé¢†åŸŸå±‚
â”‚   â””â”€â”€ XiHan.BasicApp.Web.Core       # WebåŸºç¡€è®¾æ–½å±‚
â”œâ”€â”€ modules/            # ä¸šåŠ¡æ¨¡å—å±‚
â”‚   â”œâ”€â”€ XiHan.BasicApp.Rbac           # RBACæƒé™æ§åˆ¶æ¨¡å—
â”‚   â””â”€â”€ XiHan.BasicApp.CodeGeneration # ä»£ç ç”Ÿæˆæ¨¡å—
â””â”€â”€ main/              # åº”ç”¨ç¨‹åºå…¥å£
    â””â”€â”€ XiHan.BasicApp.WebHost        # Webå®¿ä¸»
```

---

## âœ… æ¶æ„ä¼˜åŠ¿

### 1. æ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„
- âœ… ä½¿ç”¨ `[DependsOn]` ç‰¹æ€§æ˜¾å¼å£°æ˜æ¨¡å—ä¾èµ–å…³ç³»
- âœ… æ¡†æ¶å±‚ã€ä¸šåŠ¡æ¨¡å—å±‚ã€åº”ç”¨å±‚åˆ†ç¦»æ˜ç¡®
- âœ… æ”¯æŒæ¨¡å—çš„çƒ­æ’æ‹”å’Œç‹¬ç«‹å¼€å‘

### 2. DDD ç†å¿µåº”ç”¨
- âœ… å­˜åœ¨èšåˆæ ¹ (Aggregate Root) æ¦‚å¿µ
- âœ… å®ä½“ (Entity) ä¸å€¼å¯¹è±¡ (Value Object) åˆ†ç¦»
- âœ… é¢†åŸŸæœåŠ¡å±‚ç‹¬ç«‹äºåº”ç”¨æœåŠ¡å±‚
- âœ… ä½¿ç”¨ä»“å‚¨æ¨¡å¼ (Repository Pattern) æŠ½è±¡æ•°æ®è®¿é—®

### 3. ä¼ä¸šçº§ç‰¹æ€§æ”¯æŒ
- âœ… å¤šç§Ÿæˆ· (Multi-tenancy) æ”¯æŒ
- âœ… äº‹ä»¶æ€»çº¿ (Event Bus) é›†æˆ
- âœ… åˆ†å¸ƒå¼IDç”Ÿæˆ
- âœ… ç¼“å­˜ã€æœ¬åœ°åŒ–ã€éªŒè¯ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹å¤„ç†

### 4. é…ç½®é©±åŠ¨å¼€å‘
- âœ… ä½¿ç”¨ appsettings.json è¿›è¡Œå¤–éƒ¨åŒ–é…ç½®
- âœ… Options Pattern å®ç°å¼ºç±»å‹é…ç½®
- âœ… ç¯å¢ƒç‰¹å®šé…ç½®æ–‡ä»¶æ”¯æŒ

---

## âš ï¸ æ¶æ„ä¸è¶³ä¸æ”¹è¿›å»ºè®®

### ğŸ”´ é—®é¢˜ 1: è¿‡åº¦ä¾èµ–å•ä¸€è‡ªç ”æ¡†æ¶

**ç°çŠ¶é—®é¢˜**:
```csharp
// XiHan.BasicApp.Core.csproj ä¸­æœ‰ 35+ ä¸ª XiHan.Framework åŒ…ä¾èµ–
<PackageReference Include="XiHan.Framework.Application" Version="2.2.0-alpha.1" />
<PackageReference Include="XiHan.Framework.Authentication" Version="2.2.0-alpha.1" />
<PackageReference Include="XiHan.Framework.Authorization" Version="2.2.0-alpha.1" />
<PackageReference Include="XiHan.Framework.Bot" Version="2.2.0-alpha.1" />
<PackageReference Include="XiHan.Framework.Caching" Version="2.2.0-alpha.1" />
// ... 30+ more packages
```

**é—®é¢˜åˆ†æ**:
- æ‰€æœ‰åŒ…ç‰ˆæœ¬å‡ä¸º **alpha ç‰ˆæœ¬** (2.2.0-alpha.1)ï¼Œç”Ÿäº§ç¨³å®šæ€§å­˜ç–‘
- æ ¸å¿ƒå±‚ç›´æ¥ä¾èµ– 35+ ä¸ªæ¡†æ¶åŒ…ï¼Œ**è€¦åˆåº¦æé«˜**
- æ¡†æ¶è¿­ä»£ä¼šå½±å“æ‰€æœ‰ä¸šåŠ¡æ¨¡å—
- å›¢é˜Ÿå­¦ä¹ æ›²çº¿é™¡å³­ï¼Œæ–°æˆå‘˜éœ€è¦å­¦ä¹ æ•´ä¸ªè‡ªç ”æ¡†æ¶ä½“ç³»
- ç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜ (CodeGeneration è¿˜åœ¨ä½¿ç”¨ 2.1.0-alpha)

**æ”¹è¿›å»ºè®®**:

**æ–¹æ¡ˆ 1: å¼•å…¥é€‚é…å™¨å±‚ (Adapter Layer)**
```
æ¨èæŒ‡æ•°: â­â­â­â­â­

åˆ›å»º XiHan.BasicApp.Infrastructure å±‚ï¼š
- å°† XiHan.Framework.* çš„ä¾èµ–é™åˆ¶åœ¨æ­¤å±‚
- ä¸šåŠ¡æ¨¡å—é€šè¿‡æŠ½è±¡æ¥å£ä¾èµ–åŸºç¡€è®¾æ–½
- æœªæ¥å¯ä»¥é€æ­¥æ›¿æ¢åº•å±‚å®ç°è€Œä¸å½±å“ä¸šåŠ¡ä»£ç 

ä¼˜åŠ¿ï¼š
âœ“ é™ä½ä¸šåŠ¡ä»£ç ä¸æ¡†æ¶çš„è€¦åˆ
âœ“ ä¾¿äºæµ‹è¯•ï¼ˆå¯mockåŸºç¡€è®¾æ–½ï¼‰
âœ“ æé«˜å¯ç§»æ¤æ€§
```

**æ–¹æ¡ˆ 2: ä¾èµ–ç˜¦èº«**
```
æ¨èæŒ‡æ•°: â­â­â­â­

å®¡è®¡æ¯ä¸ªæ¡†æ¶åŒ…çš„å®é™…ä½¿ç”¨æƒ…å†µï¼š
- ç§»é™¤æœªä½¿ç”¨æˆ–ä½¿ç”¨ç‡ä½çš„åŒ…
- åˆå¹¶åŠŸèƒ½ç›¸è¿‘çš„åŒ…
- åªåœ¨éœ€è¦çš„æ¨¡å—ä¸­å¼•å…¥ç‰¹å®šåŠŸèƒ½

å»ºè®®ä¿ç•™æ ¸å¿ƒåŒ…ï¼š
âœ“ XiHan.Framework.Core
âœ“ XiHan.Framework.Domain
âœ“ XiHan.Framework.Data
âœ“ XiHan.Framework.Application
```

**æ–¹æ¡ˆ 3: ç‰ˆæœ¬ç»Ÿä¸€ç®¡ç†**
```
æ¨èæŒ‡æ•°: â­â­â­â­â­

ä½¿ç”¨ Directory.Build.props ç»Ÿä¸€ç®¡ç†ç‰ˆæœ¬ï¼š
<Project>
  <PropertyGroup>
    <XiHanFrameworkVersion>2.2.0-alpha.1</XiHanFrameworkVersion>
  </PropertyGroup>
</Project>

æ‰€æœ‰é¡¹ç›®å¼•ç”¨ï¼š
<PackageReference Include="XiHan.Framework.Core" 
                  Version="$(XiHanFrameworkVersion)" />
```

---

### ğŸ”´ é—®é¢˜ 2: DDD å®ç°ä¸å¤Ÿå½»åº•

**ç°çŠ¶é—®é¢˜**:

1. **å®ä½“è´«è¡€æ¨¡å‹ (Anemic Domain Model)**
```csharp
// SysUser.cs - åªæœ‰å±æ€§ï¼Œæ²¡æœ‰è¡Œä¸º
public partial class SysUser : RbacAggregateRoot<long>
{
    public virtual string UserName { get; set; } = string.Empty;
    public virtual string Password { get; set; } = string.Empty;
    // ... åªæœ‰ getter/setterï¼Œæ— ä¸šåŠ¡é€»è¾‘
}
```

2. **ç¼ºå°‘å€¼å¯¹è±¡å°è£…**
```csharp
// å¯†ç åº”è¯¥æ˜¯å€¼å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç®€å•çš„å­—ç¬¦ä¸²
public virtual string Password { get; set; } = string.Empty;

// åº”è¯¥å°è£…ä¸ºï¼š
public Password Password { get; private set; }
```

3. **é¢†åŸŸäº‹ä»¶ç¼ºå¤±**
```csharp
// ç”¨æˆ·åˆ›å»ºã€è§’è‰²åˆ†é…ç­‰å…³é”®æ“ä½œç¼ºå°‘é¢†åŸŸäº‹ä»¶å‘å¸ƒ
// æ–‡æ¡£ä¸­æåˆ°äº† UserCreatedEventï¼Œä½†å®é™…ä»£ç ä¸­æœªè§å®ç°
```

**æ”¹è¿›å»ºè®®**:

**å»ºè®® 1: å……å®èšåˆæ ¹è¡Œä¸º**
```csharp
æ¨èæŒ‡æ•°: â­â­â­â­â­

// âŒ å½“å‰å®ç°ï¼ˆè´«è¡€æ¨¡å‹ï¼‰
public class SysUser : RbacAggregateRoot<long>
{
    public string Password { get; set; }
    public bool IsEnabled { get; set; }
}

// âœ… æ¨èå®ç°ï¼ˆå¯Œé¢†åŸŸæ¨¡å‹ï¼‰
public class SysUser : RbacAggregateRoot<long>
{
    private Password _password;
    private bool _isEnabled;

    public void ChangePassword(Password oldPassword, Password newPassword, 
                               IPasswordPolicy policy)
    {
        if (!_password.VerifyPassword(oldPassword))
            throw new DomainException("åŸå¯†ç é”™è¯¯");
        
        if (!policy.Validate(newPassword))
            throw new DomainException("æ–°å¯†ç ä¸ç¬¦åˆç­–ç•¥");

        _password = newPassword;
        AddDomainEvent(new UserPasswordChangedEvent(Id));
    }

    public void Enable()
    {
        if (_isEnabled) return;
        _isEnabled = true;
        AddDomainEvent(new UserEnabledEvent(Id));
    }

    public void Disable(string reason)
    {
        if (!_isEnabled) return;
        _isEnabled = false;
        AddDomainEvent(new UserDisabledEvent(Id, reason));
    }
}
```

**å»ºè®® 2: å¼•å…¥å€¼å¯¹è±¡**
```csharp
æ¨èæŒ‡æ•°: â­â­â­â­â­

åˆ›å»º ValueObjects ç›®å½•ï¼š

// Password.cs - å¯†ç å€¼å¯¹è±¡
public class Password : ValueObject
{
    public string Hash { get; private set; }
    
    private Password(string hash) => Hash = hash;
    
    public static Password Create(string plainText, IPasswordHasher hasher)
    {
        if (string.IsNullOrWhiteSpace(plainText))
            throw new ArgumentException("å¯†ç ä¸èƒ½ä¸ºç©º");
        
        var hash = hasher.HashPassword(plainText);
        return new Password(hash);
    }

    public bool VerifyPassword(string plainText, IPasswordHasher hasher)
        => hasher.VerifyHashedPassword(Hash, plainText);
    
    protected override IEnumerable<object> GetEqualityComponents()
    {
        yield return Hash;
    }
}

// Email.cs - é‚®ç®±å€¼å¯¹è±¡
public class Email : ValueObject
{
    public string Value { get; private set; }
    
    private Email(string value) => Value = value;
    
    public static Email Create(string email)
    {
        if (!IsValidEmail(email))
            throw new ArgumentException("é‚®ç®±æ ¼å¼æ— æ•ˆ");
        return new Email(email);
    }
    
    private static bool IsValidEmail(string email)
        => Regex.IsMatch(email, @"^[^@\s]+@[^@\s]+\.[^@\s]+$");
    
    protected override IEnumerable<object> GetEqualityComponents()
    {
        yield return Value;
    }
}
```

**å»ºè®® 3: å®ç°é¢†åŸŸäº‹ä»¶**
```csharp
æ¨èæŒ‡æ•°: â­â­â­â­â­

// 1. åœ¨ Events ç›®å½•åˆ›å»ºé¢†åŸŸäº‹ä»¶
public class UserCreatedEvent : DomainEvent
{
    public long UserId { get; }
    public string UserName { get; }
    
    public UserCreatedEvent(long userId, string userName)
    {
        UserId = userId;
        UserName = userName;
    }
}

// 2. åœ¨èšåˆæ ¹ä¸­å‘å¸ƒäº‹ä»¶
public class SysUser : RbacAggregateRoot<long>
{
    public static SysUser Create(string userName, Password password)
    {
        var user = new SysUser
        {
            UserName = userName,
            _password = password,
            CreatedAt = DateTime.UtcNow
        };
        
        user.AddDomainEvent(new UserCreatedEvent(user.Id, userName));
        return user;
    }
}

// 3. åˆ›å»ºäº‹ä»¶å¤„ç†å™¨
public class UserCreatedEventHandler : IEventHandler<UserCreatedEvent>
{
    private readonly IEmailService _emailService;
    
    public async Task Handle(UserCreatedEvent @event)
    {
        await _emailService.SendWelcomeEmail(@event.UserId);
        // è®°å½•å®¡è®¡æ—¥å¿—ã€å‘é€é€šçŸ¥ç­‰
    }
}
```

---

### ğŸ”´ é—®é¢˜ 3: ç¼ºå°‘ CQRS åˆ†ç¦»

**ç°çŠ¶é—®é¢˜**:
- æ‰€æœ‰æœåŠ¡æ··åˆè¯»å†™æ“ä½œï¼ŒæŸ¥è¯¢å’Œå‘½ä»¤æ²¡æœ‰åˆ†ç¦»
- å¤æ‚æŸ¥è¯¢ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆåœ¨åŒä¸€ä¸ªæœåŠ¡ä¸­
- æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–å›°éš¾ï¼ˆéœ€è¦ä¸ä¸šåŠ¡äº‹åŠ¡ä¿æŒä¸€è‡´ï¼‰

**æ”¹è¿›å»ºè®®**:

```csharp
æ¨èæŒ‡æ•°: â­â­â­â­

// 1. åˆ›å»º Commands å’Œ Queries ç›®å½•ç»“æ„
XiHan.BasicApp.Rbac/
â”œâ”€â”€ Commands/              # å†™æ“ä½œ
â”‚   â”œâ”€â”€ CreateUserCommand.cs
â”‚   â”œâ”€â”€ CreateUserCommandHandler.cs
â”‚   â”œâ”€â”€ ChangePasswordCommand.cs
â”‚   â””â”€â”€ AssignRoleCommand.cs
â”œâ”€â”€ Queries/               # è¯»æ“ä½œ
â”‚   â”œâ”€â”€ GetUserByIdQuery.cs
â”‚   â”œâ”€â”€ GetUserByIdQueryHandler.cs
â”‚   â”œâ”€â”€ GetUserListQuery.cs
â”‚   â””â”€â”€ GetUserPermissionsQuery.cs

// 2. ä½¿ç”¨ MediatR å®ç° CQRS
// Commands - ä¿®æ”¹çŠ¶æ€ï¼Œè¿”å›æˆåŠŸ/å¤±è´¥
public class CreateUserCommand : IRequest<Result<long>>
{
    public string UserName { get; set; }
    public string Password { get; set; }
    public string Email { get; set; }
}

public class CreateUserCommandHandler 
    : IRequestHandler<CreateUserCommand, Result<long>>
{
    private readonly IUserRepository _repository;
    private readonly UserDomainService _domainService;
    
    public async Task<Result<long>> Handle(
        CreateUserCommand request, 
        CancellationToken ct)
    {
        // ä¸šåŠ¡é€»è¾‘éªŒè¯
        var user = SysUser.Create(
            request.UserName, 
            Password.Create(request.Password)
        );
        
        await _repository.AddAsync(user, ct);
        return Result.Success(user.Id);
    }
}

// Queries - åªè¯»æŸ¥è¯¢ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“
public class GetUserListQuery : IRequest<PagedResult<UserDto>>
{
    public int PageIndex { get; set; }
    public int PageSize { get; set; }
    public string? SearchTerm { get; set; }
}

public class GetUserListQueryHandler 
    : IRequestHandler<GetUserListQuery, PagedResult<UserDto>>
{
    private readonly ISqlSugarClient _db;
    
    public async Task<PagedResult<UserDto>> Handle(
        GetUserListQuery request, 
        CancellationToken ct)
    {
        // ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œç»•è¿‡é¢†åŸŸå±‚ï¼Œæé«˜æ€§èƒ½
        var query = _db.Queryable<SysUser>()
            .WhereIF(!string.IsNullOrEmpty(request.SearchTerm),
                u => u.UserName.Contains(request.SearchTerm));
        
        var total = await query.CountAsync(ct);
        var users = await query
            .Select(u => new UserDto { ... })
            .ToPageListAsync(request.PageIndex, request.PageSize, ct);
        
        return new PagedResult<UserDto>(users, total);
    }
}

// 3. åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨
[ApiController]
[Route("api/[controller]")]
public class UsersController : ControllerBase
{
    private readonly IMediator _mediator;
    
    [HttpPost]
    public async Task<IActionResult> Create(CreateUserCommand command)
        => Ok(await _mediator.Send(command));
    
    [HttpGet]
    public async Task<IActionResult> GetList([FromQuery] GetUserListQuery query)
        => Ok(await _mediator.Send(query));
}
```

**CQRS å¸¦æ¥çš„ä¼˜åŠ¿**:
- âœ… è¯»å†™åˆ†ç¦»ï¼ŒèŒè´£æ¸…æ™°
- âœ… æŸ¥è¯¢å¯ä»¥ç»•è¿‡é¢†åŸŸå±‚ï¼Œç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæé«˜æ€§èƒ½
- âœ… å‘½ä»¤ä¸“æ³¨äºä¸šåŠ¡è§„åˆ™éªŒè¯å’ŒçŠ¶æ€å˜æ›´
- âœ… ä¾¿äºåç»­å¼•å…¥è¯»å†™æ•°æ®åº“åˆ†ç¦»
- âœ… ä»£ç æ›´æ˜“æµ‹è¯•å’Œç»´æŠ¤

---

### ğŸ”´ é—®é¢˜ 4: ç¼ºå°‘åº”ç”¨æœåŠ¡å±‚

**ç°çŠ¶é—®é¢˜**:
```csharp
// ServiceCollectionExtensions.cs
public static IServiceCollection AddRbacApplicationServices(
    this IServiceCollection services)
{
    return services;  // âŒ ç©ºå®ç°ï¼æ²¡æœ‰åº”ç”¨æœåŠ¡
}
```

**é—®é¢˜åˆ†æ**:
- å½“å‰æ¶æ„ç¼ºå°‘åº”ç”¨æœåŠ¡å±‚ (Application Layer)
- é¢†åŸŸæœåŠ¡ç›´æ¥æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨ï¼Œè¿åäº†åˆ†å±‚åŸåˆ™
- äº‹åŠ¡è¾¹ç•Œã€å·¥ä½œå•å…ƒç®¡ç†ä¸æ¸…æ™°
- ç¼ºå°‘åº”ç”¨çº§åˆ«çš„ç”¨ä¾‹ç¼–æ’

**æ”¹è¿›å»ºè®®**:

```csharp
æ¨èæŒ‡æ•°: â­â­â­â­â­

// 1. åˆ›å»ºåº”ç”¨æœåŠ¡å±‚
XiHan.BasicApp.Rbac/Services/Application/
â”œâ”€â”€ Users/
â”‚   â”œâ”€â”€ UserApplicationService.cs
â”‚   â””â”€â”€ IUserApplicationService.cs
â”œâ”€â”€ Roles/
â”‚   â”œâ”€â”€ RoleApplicationService.cs
â”‚   â””â”€â”€ IRoleApplicationService.cs

// 2. åº”ç”¨æœåŠ¡å®ç°ç¤ºä¾‹
public interface IUserApplicationService
{
    Task<Result<long>> CreateUserAsync(CreateUserDto dto, CancellationToken ct);
    Task<Result> ChangePasswordAsync(long userId, ChangePasswordDto dto, CancellationToken ct);
    Task<Result> AssignRolesToUserAsync(long userId, List<long> roleIds, CancellationToken ct);
}

public class UserApplicationService : IUserApplicationService
{
    private readonly IUserRepository _userRepository;
    private readonly IRoleRepository _roleRepository;
    private readonly UserDomainService _userDomainService;
    private readonly IUnitOfWork _unitOfWork;
    private readonly IEventBus _eventBus;
    
    // ç”¨ä¾‹ï¼šåˆ›å»ºç”¨æˆ·
    public async Task<Result<long>> CreateUserAsync(
        CreateUserDto dto, 
        CancellationToken ct)
    {
        // 1. åº”ç”¨å±‚éªŒè¯
        if (await _userRepository.ExistsByUserNameAsync(dto.UserName, ct))
            return Result.Failure<long>("ç”¨æˆ·åå·²å­˜åœ¨");
        
        // 2. è°ƒç”¨é¢†åŸŸæœåŠ¡è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†
        var user = _userDomainService.CreateUser(
            dto.UserName, 
            dto.Password,
            dto.Email
        );
        
        // 3. æŒä¹…åŒ–
        await _userRepository.AddAsync(user, ct);
        
        // 4. æäº¤äº‹åŠ¡
        await _unitOfWork.CommitAsync(ct);
        
        // 5. å‘å¸ƒé›†æˆäº‹ä»¶ï¼ˆè·¨æ¨¡å—é€šä¿¡ï¼‰
        await _eventBus.PublishAsync(new UserCreatedIntegrationEvent
        {
            UserId = user.Id,
            UserName = user.UserName
        }, ct);
        
        return Result.Success(user.Id);
    }
    
    // ç”¨ä¾‹ï¼šä¸ºç”¨æˆ·åˆ†é…è§’è‰²ï¼ˆè·¨èšåˆæ“ä½œï¼‰
    public async Task<Result> AssignRolesToUserAsync(
        long userId, 
        List<long> roleIds, 
        CancellationToken ct)
    {
        // 1. åŠ è½½èšåˆ
        var user = await _userRepository.GetByIdAsync(userId, ct);
        if (user == null)
            return Result.Failure("ç”¨æˆ·ä¸å­˜åœ¨");
        
        var roles = await _roleRepository.GetByIdsAsync(roleIds, ct);
        if (roles.Count != roleIds.Count)
            return Result.Failure("éƒ¨åˆ†è§’è‰²ä¸å­˜åœ¨");
        
        // 2. è°ƒç”¨é¢†åŸŸæœåŠ¡è¿›è¡Œè·¨èšåˆä¸šåŠ¡é€»è¾‘
        await _userDomainService.AssignRolesToUserAsync(user, roles, ct);
        
        // 3. æäº¤å·¥ä½œå•å…ƒ
        await _unitOfWork.CommitAsync(ct);
        
        return Result.Success();
    }
}

// 3. æ³¨å†Œåº”ç”¨æœåŠ¡
public static IServiceCollection AddRbacApplicationServices(
    this IServiceCollection services)
{
    services.AddScoped<IUserApplicationService, UserApplicationService>();
    services.AddScoped<IRoleApplicationService, RoleApplicationService>();
    services.AddScoped<IPermissionApplicationService, PermissionApplicationService>();
    
    return services;
}
```

**åº”ç”¨æœåŠ¡å±‚çš„èŒè´£**:
- âœ… ç”¨ä¾‹ç¼–æ’ (Use Case Orchestration)
- âœ… äº‹åŠ¡è¾¹ç•Œç®¡ç†
- âœ… è·¨èšåˆåè°ƒ
- âœ… é›†æˆäº‹ä»¶å‘å¸ƒ
- âœ… DTO è½¬æ¢
- âœ… åº”ç”¨çº§åˆ«çš„éªŒè¯å’Œæˆæƒ

---

### ğŸ”´ é—®é¢˜ 5: æ•°æ®åº“åˆå§‹åŒ–æ–¹å¼ä¸åˆç†

**ç°çŠ¶é—®é¢˜**:
```csharp
// XiHanBasicAppRbacModule.cs
public override void OnApplicationInitialization(ApplicationInitializationContext context)
{
    var app = context.GetApplicationBuilder();
    AsyncHelper.RunSync(async () =>    // âŒ ä½¿ç”¨ AsyncHelper.RunSync
    {
        await app.UseDbInitializerAsync(initialize: true);
    });
}
```

**é—®é¢˜åˆ†æ**:
- ä½¿ç”¨ `AsyncHelper.RunSync` å¯èƒ½å¯¼è‡´æ­»é”
- æ¯æ¬¡å¯åŠ¨éƒ½æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–é€»è¾‘ï¼Œæ€§èƒ½æµªè´¹
- æ•°æ®åº“è¿ç§»ä¸ç§å­æ•°æ®æ··åœ¨ä¸€èµ·
- ç”Ÿäº§ç¯å¢ƒä¸åº”è¯¥è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»

**æ”¹è¿›å»ºè®®**:

```csharp
æ¨èæŒ‡æ•°: â­â­â­â­â­

// æ–¹æ¡ˆ 1: åˆ†ç¦»è¿ç§»å’Œç§å­æ•°æ®

// 1. ä½¿ç”¨ EF Core Migrationsï¼ˆæˆ– FluentMigratorï¼‰
// åˆ›å»ºç‹¬ç«‹çš„è¿ç§»å·¥å…·é¡¹ç›®
XiHan.BasicApp.Migrator/
â”œâ”€â”€ Migrations/
â”‚   â”œâ”€â”€ 20260123_InitialCreate.cs
â”‚   â”œâ”€â”€ 20260124_AddUserTable.cs
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Seeds/
â”‚   â”œâ”€â”€ DefaultRolesSeeder.cs
â”‚   â””â”€â”€ AdminUserSeeder.cs
â””â”€â”€ Program.cs

// 2. Program.cs - è¿ç§»å·¥å…·
public class Program
{
    public static async Task Main(string[] args)
    {
        var host = CreateHostBuilder(args).Build();
        
        using var scope = host.Services.CreateScope();
        var dbContext = scope.ServiceProvider.GetRequiredService<AppDbContext>();
        
        // æ‰§è¡Œæ•°æ®åº“è¿ç§»
        await dbContext.Database.MigrateAsync();
        
        // å¯é€‰ï¼šæ‰§è¡Œç§å­æ•°æ®
        if (args.Contains("--seed"))
        {
            var seeder = scope.ServiceProvider.GetRequiredService<IDataSeeder>();
            await seeder.SeedAsync();
        }
    }
}

// 3. æ¨¡å—åˆå§‹åŒ– - ç§»é™¤æ•°æ®åº“åˆå§‹åŒ–
public override void OnApplicationInitialization(ApplicationInitializationContext context)
{
    // âŒ ç§»é™¤æ­¤ä»£ç 
    // var app = context.GetApplicationBuilder();
    // AsyncHelper.RunSync(async () =>
    // {
    //     await app.UseDbInitializerAsync(initialize: true);
    // });
    
    // âœ… åªåˆå§‹åŒ–åº”ç”¨çº§åˆ«çš„ç»„ä»¶
    var app = context.GetApplicationBuilder();
    // å…¶ä»–åˆå§‹åŒ–é€»è¾‘...
}

// æ–¹æ¡ˆ 2: ä½¿ç”¨å¯åŠ¨æ£€æŸ¥å™¨ï¼ˆä¿ç•™å½“å‰æ–¹å¼ä½†æ”¹è¿›ï¼‰
public override async Task OnApplicationInitializationAsync(
    ApplicationInitializationContext context)
{
    var app = context.GetApplicationBuilder();
    var env = context.ServiceProvider.GetRequiredService<IWebHostEnvironment>();
    
    // åªåœ¨å¼€å‘ç¯å¢ƒè‡ªåŠ¨è¿ç§»
    if (env.IsDevelopment())
    {
        var dbInitializer = context.ServiceProvider
            .GetRequiredService<IDbInitializer>();
        
        await dbInitializer.InitializeAsync();
        await dbInitializer.SeedAsync();
    }
}
```

**éƒ¨ç½²æµç¨‹å»ºè®®**:
```bash
# å¼€å‘ç¯å¢ƒ
dotnet run --project XiHan.BasicApp.Migrator -- --seed

# ç”Ÿäº§ç¯å¢ƒï¼ˆåˆ†æ­¥æ‰§è¡Œï¼‰
# 1. å…ˆè¿ç§»æ•°æ®åº“
dotnet run --project XiHan.BasicApp.Migrator

# 2. å†å¯åŠ¨åº”ç”¨
dotnet run --project XiHan.BasicApp.WebHost

# 3. æ‰‹åŠ¨æ‰§è¡Œç§å­æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰
dotnet run --project XiHan.BasicApp.Migrator -- --seed
```

---

### ğŸŸ¡ é—®é¢˜ 6: ç¼ºå°‘å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

**ç°çŠ¶é—®é¢˜**:
- é¡¹ç›®ä¸­æœªå‘ç°æµ‹è¯•é¡¹ç›®
- æ— æ³•ä¿è¯ä»£ç è´¨é‡å’Œé‡æ„å®‰å…¨æ€§
- ç¼ºå°‘é¢†åŸŸé€»è¾‘çš„æµ‹è¯•è¦†ç›–

**æ”¹è¿›å»ºè®®**:

```csharp
æ¨èæŒ‡æ•°: â­â­â­â­â­

// 1. åˆ›å»ºæµ‹è¯•é¡¹ç›®ç»“æ„
tests/
â”œâ”€â”€ XiHan.BasicApp.Domain.Tests/       # é¢†åŸŸå±‚å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â””â”€â”€ SysUserTests.cs
â”‚   â”œâ”€â”€ ValueObjects/
â”‚   â”‚   â”œâ”€â”€ PasswordTests.cs
â”‚   â”‚   â””â”€â”€ EmailTests.cs
â”‚   â””â”€â”€ Services/
â”‚       â””â”€â”€ UserDomainServiceTests.cs
â”œâ”€â”€ XiHan.BasicApp.Application.Tests/  # åº”ç”¨å±‚å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ Users/
â”‚       â””â”€â”€ UserApplicationServiceTests.cs
â””â”€â”€ XiHan.BasicApp.Integration.Tests/  # é›†æˆæµ‹è¯•
    â”œâ”€â”€ Api/
    â”‚   â””â”€â”€ UsersControllerTests.cs
    â””â”€â”€ Database/
        â””â”€â”€ UserRepositoryTests.cs

// 2. é¢†åŸŸå±‚å•å…ƒæµ‹è¯•ç¤ºä¾‹
public class SysUserTests
{
    [Fact]
    public void Create_WithValidData_ShouldCreateUser()
    {
        // Arrange
        var userName = "testuser";
        var password = Password.Create("P@ssw0rd123");
        
        // Act
        var user = SysUser.Create(userName, password);
        
        // Assert
        Assert.NotNull(user);
        Assert.Equal(userName, user.UserName);
        Assert.True(user.IsEnabled);
        Assert.Contains(user.DomainEvents, 
            e => e is UserCreatedEvent);
    }
    
    [Fact]
    public void Enable_WhenDisabled_ShouldEnableAndRaiseEvent()
    {
        // Arrange
        var user = SysUser.Create("user", Password.Create("pass"));
        user.Disable("test");
        user.ClearDomainEvents();
        
        // Act
        user.Enable();
        
        // Assert
        Assert.True(user.IsEnabled);
        Assert.Contains(user.DomainEvents, 
            e => e is UserEnabledEvent);
    }
}

// 3. å€¼å¯¹è±¡å•å…ƒæµ‹è¯•
public class PasswordTests
{
    [Theory]
    [InlineData("")]
    [InlineData(" ")]
    [InlineData(null)]
    public void Create_WithInvalidPassword_ShouldThrowException(string password)
    {
        // Act & Assert
        Assert.Throws<ArgumentException>(() => 
            Password.Create(password, Mock.Of<IPasswordHasher>()));
    }
    
    [Fact]
    public void VerifyPassword_WithCorrectPassword_ShouldReturnTrue()
    {
        // Arrange
        var plainText = "MySecurePassword123";
        var hasher = new Mock<IPasswordHasher>();
        hasher.Setup(h => h.HashPassword(plainText))
              .Returns("hashedpassword");
        hasher.Setup(h => h.VerifyHashedPassword("hashedpassword", plainText))
              .Returns(true);
        
        var password = Password.Create(plainText, hasher.Object);
        
        // Act
        var result = password.VerifyPassword(plainText, hasher.Object);
        
        // Assert
        Assert.True(result);
    }
}

// 4. åº”ç”¨æœåŠ¡æµ‹è¯•
public class UserApplicationServiceTests
{
    [Fact]
    public async Task CreateUserAsync_WithValidData_ShouldSucceed()
    {
        // Arrange
        var userRepo = new Mock<IUserRepository>();
        var domainService = new Mock<UserDomainService>();
        var unitOfWork = new Mock<IUnitOfWork>();
        
        userRepo.Setup(r => r.ExistsByUserNameAsync(It.IsAny<string>(), default))
                .ReturnsAsync(false);
        
        var service = new UserApplicationService(
            userRepo.Object, 
            domainService.Object,
            unitOfWork.Object
        );
        
        var dto = new CreateUserDto 
        { 
            UserName = "test", 
            Password = "P@ss123" 
        };
        
        // Act
        var result = await service.CreateUserAsync(dto, default);
        
        // Assert
        Assert.True(result.IsSuccess);
        userRepo.Verify(r => r.AddAsync(It.IsAny<SysUser>(), default), 
                       Times.Once);
        unitOfWork.Verify(u => u.CommitAsync(default), Times.Once);
    }
}

// 5. é›†æˆæµ‹è¯•
public class UsersControllerTests : IClassFixture<WebApplicationFactory<Program>>
{
    private readonly WebApplicationFactory<Program> _factory;
    
    public UsersControllerTests(WebApplicationFactory<Program> factory)
    {
        _factory = factory;
    }
    
    [Fact]
    public async Task CreateUser_WithValidData_ShouldReturn200()
    {
        // Arrange
        var client = _factory.CreateClient();
        var command = new CreateUserCommand
        {
            UserName = "integration_test_user",
            Password = "TestP@ss123",
            Email = "test@example.com"
        };
        
        // Act
        var response = await client.PostAsJsonAsync("/api/users", command);
        
        // Assert
        response.EnsureSuccessStatusCode();
        var userId = await response.Content.ReadFromJsonAsync<long>();
        Assert.True(userId > 0);
    }
}
```

**æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡**:
- é¢†åŸŸå±‚: â‰¥ 80%
- åº”ç”¨å±‚: â‰¥ 70%
- API å±‚: â‰¥ 60%

---

### ğŸŸ¡ é—®é¢˜ 7: API æ–‡æ¡£å’Œç‰ˆæœ¬ç®¡ç†ä¸è¶³

**ç°çŠ¶é—®é¢˜**:
- ç¼ºå°‘ API æ–‡æ¡£ç”Ÿæˆé…ç½®
- æ²¡æœ‰ API ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥
- ç¼ºå°‘ API å˜æ›´ç®¡ç†æœºåˆ¶

**æ”¹è¿›å»ºè®®**:

```csharp
æ¨èæŒ‡æ•°: â­â­â­â­

// 1. é…ç½® Swagger/OpenAPI
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddSwaggerGen(c =>
        {
            // API ç‰ˆæœ¬ä¿¡æ¯
            c.SwaggerDoc("v1", new OpenApiInfo
            {
                Title = "XiHan.BasicApp API",
                Version = "v1",
                Description = "XiHan åŸºç¡€åº”ç”¨ API æ–‡æ¡£",
                Contact = new OpenApiContact
                {
                    Name = "ZhaiFanhua",
                    Email = "me@zhaifanhua.com"
                }
            });
            
            // XML æ³¨é‡Šæ–‡æ¡£
            var xmlFile = $"{Assembly.GetExecutingAssembly().GetName().Name}.xml";
            var xmlPath = Path.Combine(AppContext.BaseDirectory, xmlFile);
            c.IncludeXmlComments(xmlPath);
            
            // JWT è®¤è¯
            c.AddSecurityDefinition("Bearer", new OpenApiSecurityScheme
            {
                Description = "JWT Authorization header using the Bearer scheme.",
                Name = "Authorization",
                In = ParameterLocation.Header,
                Type = SecuritySchemeType.ApiKey,
                Scheme = "Bearer"
            });
        });
        
        // API ç‰ˆæœ¬æ§åˆ¶
        services.AddApiVersioning(options =>
        {
            options.DefaultApiVersion = new ApiVersion(1, 0);
            options.AssumeDefaultVersionWhenUnspecified = true;
            options.ReportApiVersions = true;
        });
    }
}

// 2. API ç‰ˆæœ¬æ§åˆ¶ç¤ºä¾‹
[ApiController]
[ApiVersion("1.0")]
[Route("api/v{version:apiVersion}/[controller]")]
public class UsersController : ControllerBase
{
    /// <summary>
    /// åˆ›å»ºæ–°ç”¨æˆ·
    /// </summary>
    /// <param name="command">ç”¨æˆ·åˆ›å»ºå‘½ä»¤</param>
    /// <returns>ç”¨æˆ·ID</returns>
    /// <response code="200">åˆ›å»ºæˆåŠŸ</response>
    /// <response code="400">è¯·æ±‚å‚æ•°é”™è¯¯</response>
    /// <response code="409">ç”¨æˆ·åå·²å­˜åœ¨</response>
    [HttpPost]
    [ProducesResponseType(typeof(Result<long>), StatusCodes.Status200OK)]
    [ProducesResponseType(typeof(ProblemDetails), StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> Create([FromBody] CreateUserCommand command)
    {
        var result = await _mediator.Send(command);
        return result.IsSuccess 
            ? Ok(result) 
            : BadRequest(result);
    }
}

// 3. API å˜æ›´è®°å½•
// åˆ›å»º CHANGELOG.md
## API Changelog

### v1.1.0 (2026-02-01)
**Added**
- æ–°å¢ç”¨æˆ·æ‰¹é‡å¯¼å…¥ API
- æ–°å¢è§’è‰²æƒé™æŸ¥è¯¢ API

**Changed**
- ä¿®æ”¹ç”¨æˆ·åˆ›å»º APIï¼Œå¢åŠ é‚®ç®±éªŒè¯

**Deprecated**
- `/api/v1/users/old-create` å·²åºŸå¼ƒï¼Œè¯·ä½¿ç”¨ `/api/v1/users`

**Removed**
- ç§»é™¤ v0.9 ç‰ˆæœ¬çš„æ‰€æœ‰ API

**Fixed**
- ä¿®å¤å¯†ç ä¿®æ”¹æ¥å£çš„å¹¶å‘é—®é¢˜
```

---

### ğŸŸ¡ é—®é¢˜ 8: ç¼ºå°‘æ€§èƒ½ç›‘æ§å’Œå¯è§‚æµ‹æ€§

**ç°çŠ¶é—®é¢˜**:
- ç¼ºå°‘åº”ç”¨æ€§èƒ½ç›‘æ§ (APM)
- æ²¡æœ‰ç»“æ„åŒ–æ—¥å¿—é…ç½®
- ç¼ºå°‘å¥åº·æ£€æŸ¥ç«¯ç‚¹
- ç¼ºå°‘åˆ†å¸ƒå¼è¿½è¸ª

**æ”¹è¿›å»ºè®®**:

```csharp
æ¨èæŒ‡æ•°: â­â­â­â­

// 1. æ·»åŠ å¥åº·æ£€æŸ¥
public void ConfigureServices(IServiceCollection services)
{
    services.AddHealthChecks()
        .AddSqlServer(
            connectionString: Configuration.GetConnectionString("Default"),
            name: "database",
            tags: new[] { "db", "sql" })
        .AddRedis(
            redisConnectionString: Configuration["Redis:Connection"],
            name: "redis",
            tags: new[] { "cache", "redis" })
        .AddCheck<MemoryHealthCheck>("memory");
}

public void Configure(IApplicationBuilder app)
{
    app.UseHealthChecks("/health", new HealthCheckOptions
    {
        ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse
    });
    
    app.UseHealthChecks("/health/ready", new HealthCheckOptions
    {
        Predicate = check => check.Tags.Contains("ready")
    });
    
    app.UseHealthChecks("/health/live", new HealthCheckOptions
    {
        Predicate = _ => false
    });
}

// 2. ç»“æ„åŒ–æ—¥å¿—é…ç½®ï¼ˆSerilogï¼‰
public class Program
{
    public static void Main(string[] args)
    {
        Log.Logger = new LoggerConfiguration()
            .MinimumLevel.Information()
            .MinimumLevel.Override("Microsoft", LogEventLevel.Warning)
            .MinimumLevel.Override("System", LogEventLevel.Warning)
            .Enrich.FromLogContext()
            .Enrich.WithMachineName()
            .Enrich.WithProperty("Application", "XiHan.BasicApp")
            .WriteTo.Console(new JsonFormatter())
            .WriteTo.File(
                new JsonFormatter(),
                "logs/log-.json",
                rollingInterval: RollingInterval.Day,
                retainedFileCountLimit: 30)
            .WriteTo.Elasticsearch(new ElasticsearchSinkOptions(new Uri("http://localhost:9200"))
            {
                AutoRegisterTemplate = true,
                IndexFormat = "xihan-logs-{0:yyyy.MM}"
            })
            .CreateLogger();
        
        try
        {
            Log.Information("Starting XiHan.BasicApp");
            CreateHostBuilder(args).Build().Run();
        }
        catch (Exception ex)
        {
            Log.Fatal(ex, "Application start-up failed");
        }
        finally
        {
            Log.CloseAndFlush();
        }
    }
}

// 3. åˆ†å¸ƒå¼è¿½è¸ªï¼ˆOpenTelemetryï¼‰
public void ConfigureServices(IServiceCollection services)
{
    services.AddOpenTelemetryTracing(builder =>
    {
        builder
            .SetResourceBuilder(ResourceBuilder.CreateDefault()
                .AddService("XiHan.BasicApp"))
            .AddAspNetCoreInstrumentation()
            .AddHttpClientInstrumentation()
            .AddSqlClientInstrumentation()
            .AddJaegerExporter(options =>
            {
                options.AgentHost = Configuration["Jaeger:AgentHost"];
                options.AgentPort = int.Parse(Configuration["Jaeger:AgentPort"]);
            });
    });
}

// 4. æ€§èƒ½ç›‘æ§ä¸­é—´ä»¶
public class PerformanceMonitoringMiddleware
{
    private readonly RequestDelegate _next;
    private readonly ILogger<PerformanceMonitoringMiddleware> _logger;
    
    public async Task InvokeAsync(HttpContext context)
    {
        var sw = Stopwatch.StartNew();
        
        try
        {
            await _next(context);
        }
        finally
        {
            sw.Stop();
            
            if (sw.ElapsedMilliseconds > 1000) // æ…¢è¯·æ±‚é˜ˆå€¼ï¼š1ç§’
            {
                _logger.LogWarning(
                    "Slow request detected. Path: {Path}, Method: {Method}, Duration: {Duration}ms",
                    context.Request.Path,
                    context.Request.Method,
                    sw.ElapsedMilliseconds);
            }
        }
    }
}
```

---

## ğŸ“Š æ¶æ„æˆç†Ÿåº¦è¯„ä¼°

| ç»´åº¦ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|---------|---------|--------|
| æ¨¡å—åŒ–è®¾è®¡ | â­â­â­â­ | â­â­â­â­â­ | ä¸­ |
| DDD å®ç° | â­â­ | â­â­â­â­â­ | é«˜ |
| CQRS åˆ†ç¦» | â­ | â­â­â­â­â­ | é«˜ |
| åº”ç”¨æœåŠ¡å±‚ | â­ | â­â­â­â­â­ | é«˜ |
| æµ‹è¯•è¦†ç›–ç‡ | â­ | â­â­â­â­ | é«˜ |
| ä¾èµ–ç®¡ç† | â­â­ | â­â­â­â­â­ | ä¸­ |
| API æ–‡æ¡£ | â­â­ | â­â­â­â­ | ä¸­ |
| å¯è§‚æµ‹æ€§ | â­â­ | â­â­â­â­â­ | ä¸­ |
| æ€§èƒ½ä¼˜åŒ– | â­â­â­ | â­â­â­â­â­ | ä½ |
| å®‰å…¨æ€§ | â­â­â­ | â­â­â­â­â­ | é«˜ |

---

## ğŸ¯ ä¼˜å…ˆæ”¹è¿›è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼ˆç«‹å³æ‰§è¡Œï¼‰
1. **è¡¥å…¨åº”ç”¨æœåŠ¡å±‚** - å½“å‰ä¸ºç©ºå®ç°ï¼Œéœ€è¦ç«‹å³è¡¥å……
2. **å®ç° CQRS æ¨¡å¼** - æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½
3. **å……å® DDD å®ç°** - å°†è´«è¡€æ¨¡å‹è½¬æ¢ä¸ºå¯Œé¢†åŸŸæ¨¡å‹
4. **ç»Ÿä¸€ç‰ˆæœ¬ç®¡ç†** - è§£å†³æ¡†æ¶åŒ…ç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜

### ç¬¬äºŒé˜¶æ®µï¼ˆ1-2 ä¸ªæœˆï¼‰
5. **æ·»åŠ å•å…ƒæµ‹è¯•** - æé«˜ä»£ç è´¨é‡å’Œé‡æ„ä¿¡å¿ƒ
6. **å¼•å…¥é€‚é…å™¨å±‚** - é™ä½æ¡†æ¶è€¦åˆåº¦
7. **å®Œå–„ API æ–‡æ¡£** - æå‡ API å¯ç”¨æ€§
8. **æ”¹è¿›æ•°æ®åº“è¿ç§»ç­–ç•¥** - æé«˜éƒ¨ç½²å®‰å…¨æ€§

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ3-6 ä¸ªæœˆï¼‰
9. **å¢å¼ºå¯è§‚æµ‹æ€§** - æ·»åŠ  APMã€è¿½è¸ªã€ç›‘æ§
10. **ä¾èµ–ç˜¦èº«** - ç§»é™¤ä¸å¿…è¦çš„æ¡†æ¶ä¾èµ–
11. **æ€§èƒ½ä¼˜åŒ–** - æŸ¥è¯¢ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥
12. **å®‰å…¨åŠ å›º** - å®‰å…¨å®¡è®¡ã€æ¼æ´ä¿®å¤

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. ä»£ç è§„èŒƒ
```
âœ“ ä½¿ç”¨ EditorConfig ç»Ÿä¸€ä»£ç é£æ ¼
âœ“ é…ç½® StyleCop å’Œ Roslyn Analyzers
âœ“ å®šæœŸè¿›è¡Œä»£ç å®¡æŸ¥
âœ“ ä½¿ç”¨ Git é’©å­æ‰§è¡Œä»£ç æ ¼å¼åŒ–
```

### 2. åˆ†æ”¯ç­–ç•¥
```
âœ“ é‡‡ç”¨ GitFlow å·¥ä½œæµ
âœ“ ä¸»åˆ†æ”¯ï¼šmain (ç”Ÿäº§), develop (å¼€å‘)
âœ“ åŠŸèƒ½åˆ†æ”¯ï¼šfeature/xxx
âœ“ ä¿®å¤åˆ†æ”¯ï¼šhotfix/xxx
```

### 3. CI/CD
```
âœ“ é…ç½®è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•
âœ“ ä»£ç è¦†ç›–ç‡æ£€æŸ¥
âœ“ è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
âœ“ ç”Ÿäº§éƒ¨ç½²éœ€è¦äººå·¥å®¡æ‰¹
```

### 4. æ–‡æ¡£ç»´æŠ¤
```
âœ“ åŠæ—¶æ›´æ–°æ¶æ„æ–‡æ¡£
âœ“ ç»´æŠ¤ API å˜æ›´æ—¥å¿—
âœ“ ç¼–å†™å¼€å‘è€…æŒ‡å—
âœ“ è®°å½•é‡è¦çš„æ¶æ„å†³ç­– (ADR)
```

---

## ğŸ“š å‚è€ƒèµ„æº

### DDD ç›¸å…³
- [Domain-Driven Design: Tackling Complexity in the Heart of Software](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215) - Eric Evans
- [Implementing Domain-Driven Design](https://www.amazon.com/Implementing-Domain-Driven-Design-Vaughn-Vernon/dp/0321834577) - Vaughn Vernon
- [Microsoft - DDD-oriented microservice](https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/ddd-oriented-microservice)

### CQRS ç›¸å…³
- [CQRS Pattern](https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs) - Microsoft Azure Architecture
- [MediatR](https://github.com/jbogard/MediatR) - å®ç° CQRS çš„æµè¡Œåº“

### æµ‹è¯•ç›¸å…³
- [xUnit](https://xunit.net/) - .NET æµ‹è¯•æ¡†æ¶
- [Moq](https://github.com/moq/moq4) - .NET Mocking æ¡†æ¶
- [FluentAssertions](https://fluentassertions.com/) - æ–­è¨€åº“

### å¯è§‚æµ‹æ€§
- [OpenTelemetry .NET](https://github.com/open-telemetry/opentelemetry-dotnet)
- [Serilog](https://serilog.net/)
- [Application Insights](https://learn.microsoft.com/en-us/azure/azure-monitor/app/asp-net-core)

---

## âœ… æ€»ç»“

XiHan.BasicApp æ¡†æ¶å±•ç°äº†è‰¯å¥½çš„æ¨¡å—åŒ–è®¾è®¡å’Œä¼ä¸šçº§ç‰¹æ€§æ”¯æŒï¼Œä½†åœ¨ä»¥ä¸‹å…³é”®é¢†åŸŸéœ€è¦æ”¹è¿›ï¼š

**æ ¸å¿ƒé—®é¢˜**:
1. âš ï¸ è¿‡åº¦ä¾èµ–å•ä¸€è‡ªç ”æ¡†æ¶ï¼Œè€¦åˆåº¦è¿‡é«˜
2. âš ï¸ DDD å®ç°ä¸å¤Ÿå……åˆ†ï¼Œç¼ºå°‘å¯Œé¢†åŸŸæ¨¡å‹
3. âš ï¸ ç¼ºå°‘åº”ç”¨æœåŠ¡å±‚å’Œ CQRS åˆ†ç¦»
4. âš ï¸ æµ‹è¯•è¦†ç›–ç‡ä¸è¶³

**æ”¹è¿›åçš„æ”¶ç›Š**:
- âœ… æ›´ä½çš„è€¦åˆåº¦ï¼Œæ›´é«˜çš„å¯ç»´æŠ¤æ€§
- âœ… æ›´æ¸…æ™°çš„ä»£ç ç»„ç»‡å’ŒèŒè´£åˆ†ç¦»
- âœ… æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§
- âœ… æ›´é«˜çš„ä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–ç‡

**è¡ŒåŠ¨å»ºè®®**:
å»ºè®®ä¼˜å…ˆå®æ–½ç¬¬ä¸€é˜¶æ®µçš„æ”¹è¿›é¡¹ï¼Œè¿™äº›æ”¹è¿›æˆæœ¬è¾ƒä½ä½†æ”¶ç›Šæ˜¾è‘—ï¼Œå¯ä»¥å¿«é€Ÿæå‡æ¶æ„è´¨é‡ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-01-23  
**ä½œè€…**: GitHub Copilot Coding Agent  
**å®¡é˜…çŠ¶æ€**: å¾…å®¡é˜…
