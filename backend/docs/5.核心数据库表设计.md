以下是一个**完整 RBAC 系统**的核心数据库表设计，覆盖基础“用户–角色–权限”模型及高级特性（角色继承、会话管理、职责分离约束、审计日志等）。设计遵循 RBAC 标准和实践，确保高内聚、低耦合及可扩展性。

------

## 概述

系统核心包括以下几类表：

1. **基础授权表**：用户（User）、角色（Role）、权限（Permission）、资源（Resource）、操作（Operation）。
2. **关联映射表**：用户-角色（UserRole）、角色-权限（RolePermission）、角色继承（RoleHierarchy）。
3. **高级扩展表**：会话（Session）、会话-角色（SessionRole）、约束规则（ConstraintRule）、静/动态职责分离（SSD/DSD）规则。
4. **审计与日志表**：操作日志（AuditLog）与会话日志（SessionLog）。

------

## 1️⃣ 基础授权表

### 1.1 `User` 用户表

| 字段          | 类型         | 说明                                                         |
| ------------- | ------------ | ------------------------------------------------------------ |
| user_id       | BIGINT PK    | 用户唯一标识                                                 |
| username      | VARCHAR(100) | 登录用户名，唯一                                             |
| password_hash | VARCHAR(256) | 密码散列                                                     |
| is_enabled    | TINYINT(1)   | 是否启用（0=禁用，1=启用） ([Tutorials24x7](https://www.tutorials24x7.com/mysql/guide-to-design-database-for-rbac-in-mysql?utm_source=chatgpt.com)) |
| created_at    | DATETIME     | 创建时间                                                     |
| updated_at    | DATETIME     | 更新时间                                                     |

> 用户的所有状态变更（启用/禁用、密码重置）均通过 `User` 聚合根控制，防止越权操作([阿里云开发者社区](https://developer.aliyun.com/article/322044?utm_source=chatgpt.com))。

### 1.2 `Role` 角色表

| 字段        | 类型         | 说明           |
| ----------- | ------------ | -------------- |
| role_id     | BIGINT PK    | 角色唯一标识   |
| role_name   | VARCHAR(100) | 角色名称，唯一 |
| description | VARCHAR(255) | 角色描述       |
| created_at  | DATETIME     | 创建时间       |
| updated_at  | DATETIME     | 更新时间       |

> 角色可继承自其他角色，形成层级结构，以简化权限管理([Medium](https://medium.com/@aakash_rana/simplifying-role-based-access-control-rbac-187b16c6c63f?utm_source=chatgpt.com), [GitHub](https://github.com/gaoyaxing24/RBAC?utm_source=chatgpt.com))。

### 1.3 `Permission` 权限表

| 字段          | 类型         | 说明                   |
| ------------- | ------------ | ---------------------- |
| permission_id | BIGINT PK    | 权限唯一标识           |
| resource_id   | BIGINT FK    | 关联资源表 `Resource`  |
| operation_id  | BIGINT FK    | 关联操作表 `Operation` |
| description   | VARCHAR(255) | 权限描述               |
| created_at    | DATETIME     | 创建时间               |
| updated_at    | DATETIME     | 更新时间               |

> 权限由资源与操作组成，灵活支持菜单、接口、文件等多种类型([CelerData](https://celerdata.com/glossary/role-based-access-control-rbac?utm_source=chatgpt.com), [阿里云开发者社区](https://developer.aliyun.com/article/322044?utm_source=chatgpt.com))。

### 1.4 `Resource` 资源表

| 字段        | 类型         | 说明                                                         |
| ----------- | ------------ | ------------------------------------------------------------ |
| resource_id | BIGINT PK    | 资源唯一标识                                                 |
| name        | VARCHAR(100) | 资源名称（如 `User`, `Order`）                               |
| type        | VARCHAR(50)  | 资源类型（`MENU`/`API`/`FILE`）([阿里云开发者社区](https://developer.aliyun.com/article/322044?utm_source=chatgpt.com)) |
| path        | VARCHAR(255) | 资源路径或 URL                                               |

### 1.5 `Operation` 操作表

| 字段         | 类型         | 说明                           |
| ------------ | ------------ | ------------------------------ |
| operation_id | BIGINT PK    | 操作唯一标识                   |
| name         | VARCHAR(50)  | 操作名称（如 `Read`, `Write`） |
| description  | VARCHAR(255) | 操作描述                       |

------

## 2️⃣ 关联映射表

### 2.1 `UserRole` 用户-角色映射

| 字段        | 类型      | 说明                |
| ----------- | --------- | ------------------- |
| user_id     | BIGINT FK | 关联 `User.user_id` |
| role_id     | BIGINT FK | 关联 `Role.role_id` |
| assigned_at | DATETIME  | 分配时间            |

> 多对多关系表，用户与角色的分配记录([Stack Overflow](https://stackoverflow.com/questions/190257/best-role-based-access-control-rbac-database-model?utm_source=chatgpt.com))。

### 2.2 `RolePermission` 角色-权限映射

| 字段          | 类型      | 说明                            |
| ------------- | --------- | ------------------------------- |
| role_id       | BIGINT FK | 关联 `Role.role_id`             |
| permission_id | BIGINT FK | 关联 `Permission.permission_id` |
| granted_at    | DATETIME  | 授权时间                        |

> 角色与权限的多对多关系表([Stack Overflow](https://stackoverflow.com/questions/190257/best-role-based-access-control-rbac-database-model?utm_source=chatgpt.com))。

### 2.3 `RoleHierarchy` 角色继承表

| 字段           | 类型      | 说明                           |
| -------------- | --------- | ------------------------------ |
| parent_role_id | BIGINT FK | 父角色 ID，关联 `Role.role_id` |
| child_role_id  | BIGINT FK | 子角色 ID，关联 `Role.role_id` |

> 支持层次化 RBAC，角色继承关系表([GitHub](https://github.com/gaoyaxing24/RBAC?utm_source=chatgpt.com))。

------

## 3️⃣ 高级扩展表

### 3.1 `Session` 会话表

| 字段       | 类型          | 说明                 |
| ---------- | ------------- | -------------------- |
| session_id | CHAR(36) PK   | 会话唯一标识（UUID） |
| user_id    | BIGINT FK     | 关联 `User.user_id`  |
| start_time | DATETIME      | 会话开始时间         |
| end_time   | DATETIME NULL | 会话结束时间         |
| ip_address | VARCHAR(45)   | 登录 IP              |

> 会话管理用于动态职责分离（DSD），记录会话上下文([Medium](https://medium.com/@07rohit/designing-a-role-based-access-control-rbac-system-a-scalable-approach-441f05168933?utm_source=chatgpt.com), [Medium](https://medium.com/@aakash_rana/simplifying-role-based-access-control-rbac-187b16c6c63f?utm_source=chatgpt.com))。

### 3.2 `SessionRole` 会话-角色映射

| 字段         | 类型        | 说明                      |
| ------------ | ----------- | ------------------------- |
| session_id   | CHAR(36) FK | 关联 `Session.session_id` |
| role_id      | BIGINT FK   | 关联 `Role.role_id`       |
| activated_at | DATETIME    | 角色激活时间              |

> 会话内激活的角色表，支持 DSD 约束([Medium](https://medium.com/@07rohit/designing-a-role-based-access-control-rbac-system-a-scalable-approach-441f05168933?utm_source=chatgpt.com), [CSDN](https://blog.csdn.net/Leon_Jinhai_Sun/article/details/125119808?utm_source=chatgpt.com))。

### 3.3 `ConstraintRule` 约束规则表

| 字段       | 类型         | 说明                             |
| ---------- | ------------ | -------------------------------- |
| rule_id    | BIGINT PK    | 规则唯一标识                     |
| name       | VARCHAR(100) | 规则名称                         |
| type       | VARCHAR(20)  | 规则类型（`SSD`/`DSD`）          |
| parameters | JSON         | 规则参数（角色列表、时间窗口等） |
| is_enabled | TINYINT(1)   | 是否启用                         |
| created_at | DATETIME     | 创建时间                         |

> 管理静态职责分离（SSD）和动态职责分离（DSD）规则([CiteSeerX](https://citeseerx.ist.psu.edu/document?doi=6a3fb007d33744dfd6a386efe556bbd018f99667&repid=rep1&type=pdf&utm_source=chatgpt.com), [博客园](https://www.cnblogs.com/BNTang/articles/17024549.html?utm_source=chatgpt.com))。

------

## 4️⃣ 审计与日志表

### 4.1 `AuditLog` 操作审计表

| 字段        | 类型         | 说明                                            |
| ----------- | ------------ | ----------------------------------------------- |
| log_id      | BIGINT PK    | 日志唯一标识                                    |
| user_id     | BIGINT FK    | 操作者 ID                                       |
| action      | VARCHAR(100) | 操作类型（如 `AssignRole`, `RevokePermission`） |
| target_type | VARCHAR(50)  | 目标类型（`User`/`Role`/`Permission`）          |
| target_id   | BIGINT       | 目标对象 ID                                     |
| timestamp   | DATETIME     | 操作时间                                        |
| details     | JSON         | 操作详情                                        |

> 记录所有关键变更操作，支持合规审计([Reddit](https://www.reddit.com/r/PostgreSQL/comments/t7fcvp/database_design_for_access_control/?utm_source=chatgpt.com))。

### 4.2 `SessionLog` 会话日志表

| 字段       | 类型        | 说明                                      |
| ---------- | ----------- | ----------------------------------------- |
| entry_id   | BIGINT PK   | 日志唯一标识                              |
| session_id | CHAR(36)    | 关联 `Session.session_id`                 |
| event_type | VARCHAR(50) | 事件类型（`Start`/`End`/`RoleActivated`） |
| event_time | DATETIME    | 事件时间                                  |
| metadata   | JSON        | 扩展信息                                  |

> 详细记录会话生命周期和角色激活事件，助力安全分析([CSDN](https://blog.csdn.net/csucsgoat/article/details/116906638?utm_source=chatgpt.com))。

------

## 🌟 设计要点

- **主键**：推荐使用雪花 ID 或 UUID，保障分布式环境下唯一性([CiteSeerX](https://citeseerx.ist.psu.edu/document?doi=6a3fb007d33744dfd6a386efe556bbd018f99667&repid=rep1&type=pdf&utm_source=chatgpt.com))。
- **外键约束**：保证引用完整性；关联表均应建立联合唯一索引，防止重复映射。
- **时间字段**：所有表均带 `created_at`/`updated_at`，便于审计与回溯。
- **JSON 存储**：在 `ConstraintRule.parameters`、`AuditLog.details`、`SessionLog.metadata` 等字段使用 JSON，以提高规则及日志的灵活性。
- **索引**：对高频查询字段（如 `user_id`、`role_id`、`session_id`）建索引，提升性能。

通过上述表设计，RBAC 系统实现了从基础授权到动态职责分离、审计日志等完整功能，满足企业级安全与合规需求。
