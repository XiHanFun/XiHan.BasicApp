ä»¥ä¸‹æ˜¯ä¸€ä¸ª**å®Œæ•´ RBAC ç³»ç»Ÿ**çš„æ ¸å¿ƒæ•°æ®åº“è¡¨è®¾è®¡ï¼Œè¦†ç›–åŸºç¡€â€œç”¨æˆ·â€“è§’è‰²â€“æƒé™â€æ¨¡å‹åŠé«˜çº§ç‰¹æ€§ï¼ˆè§’è‰²ç»§æ‰¿ã€ä¼šè¯ç®¡ç†ã€èŒè´£åˆ†ç¦»çº¦æŸã€å®¡è®¡æ—¥å¿—ç­‰ï¼‰ã€‚è®¾è®¡éµå¾ª RBAC æ ‡å‡†å’Œå®è·µï¼Œç¡®ä¿é«˜å†…èšã€ä½è€¦åˆåŠå¯æ‰©å±•æ€§ã€‚

------

## æ¦‚è¿°

ç³»ç»Ÿæ ¸å¿ƒåŒ…æ‹¬ä»¥ä¸‹å‡ ç±»è¡¨ï¼š

1. **åŸºç¡€æˆæƒè¡¨**ï¼šç”¨æˆ·ï¼ˆUserï¼‰ã€è§’è‰²ï¼ˆRoleï¼‰ã€æƒé™ï¼ˆPermissionï¼‰ã€èµ„æºï¼ˆResourceï¼‰ã€æ“ä½œï¼ˆOperationï¼‰ã€‚
2. **å…³è”æ˜ å°„è¡¨**ï¼šç”¨æˆ·-è§’è‰²ï¼ˆUserRoleï¼‰ã€è§’è‰²-æƒé™ï¼ˆRolePermissionï¼‰ã€è§’è‰²ç»§æ‰¿ï¼ˆRoleHierarchyï¼‰ã€‚
3. **é«˜çº§æ‰©å±•è¡¨**ï¼šä¼šè¯ï¼ˆSessionï¼‰ã€ä¼šè¯-è§’è‰²ï¼ˆSessionRoleï¼‰ã€çº¦æŸè§„åˆ™ï¼ˆConstraintRuleï¼‰ã€é™/åŠ¨æ€èŒè´£åˆ†ç¦»ï¼ˆSSD/DSDï¼‰è§„åˆ™ã€‚
4. **å®¡è®¡ä¸æ—¥å¿—è¡¨**ï¼šæ“ä½œæ—¥å¿—ï¼ˆAuditLogï¼‰ä¸ä¼šè¯æ—¥å¿—ï¼ˆSessionLogï¼‰ã€‚

------

## 1ï¸âƒ£ åŸºç¡€æˆæƒè¡¨

### 1.1 `User` ç”¨æˆ·è¡¨

| å­—æ®µ          | ç±»å‹         | è¯´æ˜                                                         |
| ------------- | ------------ | ------------------------------------------------------------ |
| user_id       | BIGINT PK    | ç”¨æˆ·å”¯ä¸€æ ‡è¯†                                                 |
| username      | VARCHAR(100) | ç™»å½•ç”¨æˆ·åï¼Œå”¯ä¸€                                             |
| password_hash | VARCHAR(256) | å¯†ç æ•£åˆ—                                                     |
| is_enabled    | TINYINT(1)   | æ˜¯å¦å¯ç”¨ï¼ˆ0=ç¦ç”¨ï¼Œ1=å¯ç”¨ï¼‰ ([Tutorials24x7](https://www.tutorials24x7.com/mysql/guide-to-design-database-for-rbac-in-mysql?utm_source=chatgpt.com)) |
| created_at    | DATETIME     | åˆ›å»ºæ—¶é—´                                                     |
| updated_at    | DATETIME     | æ›´æ–°æ—¶é—´                                                     |

> ç”¨æˆ·çš„æ‰€æœ‰çŠ¶æ€å˜æ›´ï¼ˆå¯ç”¨/ç¦ç”¨ã€å¯†ç é‡ç½®ï¼‰å‡é€šè¿‡ `User` èšåˆæ ¹æ§åˆ¶ï¼Œé˜²æ­¢è¶Šæƒæ“ä½œ([é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº](https://developer.aliyun.com/article/322044?utm_source=chatgpt.com))ã€‚

### 1.2 `Role` è§’è‰²è¡¨

| å­—æ®µ        | ç±»å‹         | è¯´æ˜           |
| ----------- | ------------ | -------------- |
| role_id     | BIGINT PK    | è§’è‰²å”¯ä¸€æ ‡è¯†   |
| role_name   | VARCHAR(100) | è§’è‰²åç§°ï¼Œå”¯ä¸€ |
| description | VARCHAR(255) | è§’è‰²æè¿°       |
| created_at  | DATETIME     | åˆ›å»ºæ—¶é—´       |
| updated_at  | DATETIME     | æ›´æ–°æ—¶é—´       |

> è§’è‰²å¯ç»§æ‰¿è‡ªå…¶ä»–è§’è‰²ï¼Œå½¢æˆå±‚çº§ç»“æ„ï¼Œä»¥ç®€åŒ–æƒé™ç®¡ç†([Medium](https://medium.com/@aakash_rana/simplifying-role-based-access-control-rbac-187b16c6c63f?utm_source=chatgpt.com), [GitHub](https://github.com/gaoyaxing24/RBAC?utm_source=chatgpt.com))ã€‚

### 1.3 `Permission` æƒé™è¡¨

| å­—æ®µ          | ç±»å‹         | è¯´æ˜                   |
| ------------- | ------------ | ---------------------- |
| permission_id | BIGINT PK    | æƒé™å”¯ä¸€æ ‡è¯†           |
| resource_id   | BIGINT FK    | å…³è”èµ„æºè¡¨ `Resource`  |
| operation_id  | BIGINT FK    | å…³è”æ“ä½œè¡¨ `Operation` |
| description   | VARCHAR(255) | æƒé™æè¿°               |
| created_at    | DATETIME     | åˆ›å»ºæ—¶é—´               |
| updated_at    | DATETIME     | æ›´æ–°æ—¶é—´               |

> æƒé™ç”±èµ„æºä¸æ“ä½œç»„æˆï¼Œçµæ´»æ”¯æŒèœå•ã€æ¥å£ã€æ–‡ä»¶ç­‰å¤šç§ç±»å‹([CelerData](https://celerdata.com/glossary/role-based-access-control-rbac?utm_source=chatgpt.com), [é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº](https://developer.aliyun.com/article/322044?utm_source=chatgpt.com))ã€‚

### 1.4 `Resource` èµ„æºè¡¨

| å­—æ®µ        | ç±»å‹         | è¯´æ˜                                                         |
| ----------- | ------------ | ------------------------------------------------------------ |
| resource_id | BIGINT PK    | èµ„æºå”¯ä¸€æ ‡è¯†                                                 |
| name        | VARCHAR(100) | èµ„æºåç§°ï¼ˆå¦‚ `User`, `Order`ï¼‰                               |
| type        | VARCHAR(50)  | èµ„æºç±»å‹ï¼ˆ`MENU`/`API`/`FILE`ï¼‰([é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº](https://developer.aliyun.com/article/322044?utm_source=chatgpt.com)) |
| path        | VARCHAR(255) | èµ„æºè·¯å¾„æˆ– URL                                               |

### 1.5 `Operation` æ“ä½œè¡¨

| å­—æ®µ         | ç±»å‹         | è¯´æ˜                           |
| ------------ | ------------ | ------------------------------ |
| operation_id | BIGINT PK    | æ“ä½œå”¯ä¸€æ ‡è¯†                   |
| name         | VARCHAR(50)  | æ“ä½œåç§°ï¼ˆå¦‚ `Read`, `Write`ï¼‰ |
| description  | VARCHAR(255) | æ“ä½œæè¿°                       |

------

## 2ï¸âƒ£ å…³è”æ˜ å°„è¡¨

### 2.1 `UserRole` ç”¨æˆ·-è§’è‰²æ˜ å°„

| å­—æ®µ        | ç±»å‹      | è¯´æ˜                |
| ----------- | --------- | ------------------- |
| user_id     | BIGINT FK | å…³è” `User.user_id` |
| role_id     | BIGINT FK | å…³è” `Role.role_id` |
| assigned_at | DATETIME  | åˆ†é…æ—¶é—´            |

> å¤šå¯¹å¤šå…³ç³»è¡¨ï¼Œç”¨æˆ·ä¸è§’è‰²çš„åˆ†é…è®°å½•([Stack Overflow](https://stackoverflow.com/questions/190257/best-role-based-access-control-rbac-database-model?utm_source=chatgpt.com))ã€‚

### 2.2 `RolePermission` è§’è‰²-æƒé™æ˜ å°„

| å­—æ®µ          | ç±»å‹      | è¯´æ˜                            |
| ------------- | --------- | ------------------------------- |
| role_id       | BIGINT FK | å…³è” `Role.role_id`             |
| permission_id | BIGINT FK | å…³è” `Permission.permission_id` |
| granted_at    | DATETIME  | æˆæƒæ—¶é—´                        |

> è§’è‰²ä¸æƒé™çš„å¤šå¯¹å¤šå…³ç³»è¡¨([Stack Overflow](https://stackoverflow.com/questions/190257/best-role-based-access-control-rbac-database-model?utm_source=chatgpt.com))ã€‚

### 2.3 `RoleHierarchy` è§’è‰²ç»§æ‰¿è¡¨

| å­—æ®µ           | ç±»å‹      | è¯´æ˜                           |
| -------------- | --------- | ------------------------------ |
| parent_role_id | BIGINT FK | çˆ¶è§’è‰² IDï¼Œå…³è” `Role.role_id` |
| child_role_id  | BIGINT FK | å­è§’è‰² IDï¼Œå…³è” `Role.role_id` |

> æ”¯æŒå±‚æ¬¡åŒ– RBACï¼Œè§’è‰²ç»§æ‰¿å…³ç³»è¡¨([GitHub](https://github.com/gaoyaxing24/RBAC?utm_source=chatgpt.com))ã€‚

------

## 3ï¸âƒ£ é«˜çº§æ‰©å±•è¡¨

### 3.1 `Session` ä¼šè¯è¡¨

| å­—æ®µ       | ç±»å‹          | è¯´æ˜                 |
| ---------- | ------------- | -------------------- |
| session_id | CHAR(36) PK   | ä¼šè¯å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ |
| user_id    | BIGINT FK     | å…³è” `User.user_id`  |
| start_time | DATETIME      | ä¼šè¯å¼€å§‹æ—¶é—´         |
| end_time   | DATETIME NULL | ä¼šè¯ç»“æŸæ—¶é—´         |
| ip_address | VARCHAR(45)   | ç™»å½• IP              |

> ä¼šè¯ç®¡ç†ç”¨äºåŠ¨æ€èŒè´£åˆ†ç¦»ï¼ˆDSDï¼‰ï¼Œè®°å½•ä¼šè¯ä¸Šä¸‹æ–‡([Medium](https://medium.com/@07rohit/designing-a-role-based-access-control-rbac-system-a-scalable-approach-441f05168933?utm_source=chatgpt.com), [Medium](https://medium.com/@aakash_rana/simplifying-role-based-access-control-rbac-187b16c6c63f?utm_source=chatgpt.com))ã€‚

### 3.2 `SessionRole` ä¼šè¯-è§’è‰²æ˜ å°„

| å­—æ®µ         | ç±»å‹        | è¯´æ˜                      |
| ------------ | ----------- | ------------------------- |
| session_id   | CHAR(36) FK | å…³è” `Session.session_id` |
| role_id      | BIGINT FK   | å…³è” `Role.role_id`       |
| activated_at | DATETIME    | è§’è‰²æ¿€æ´»æ—¶é—´              |

> ä¼šè¯å†…æ¿€æ´»çš„è§’è‰²è¡¨ï¼Œæ”¯æŒ DSD çº¦æŸ([Medium](https://medium.com/@07rohit/designing-a-role-based-access-control-rbac-system-a-scalable-approach-441f05168933?utm_source=chatgpt.com), [CSDN](https://blog.csdn.net/Leon_Jinhai_Sun/article/details/125119808?utm_source=chatgpt.com))ã€‚

### 3.3 `ConstraintRule` çº¦æŸè§„åˆ™è¡¨

| å­—æ®µ       | ç±»å‹         | è¯´æ˜                             |
| ---------- | ------------ | -------------------------------- |
| rule_id    | BIGINT PK    | è§„åˆ™å”¯ä¸€æ ‡è¯†                     |
| name       | VARCHAR(100) | è§„åˆ™åç§°                         |
| type       | VARCHAR(20)  | è§„åˆ™ç±»å‹ï¼ˆ`SSD`/`DSD`ï¼‰          |
| parameters | JSON         | è§„åˆ™å‚æ•°ï¼ˆè§’è‰²åˆ—è¡¨ã€æ—¶é—´çª—å£ç­‰ï¼‰ |
| is_enabled | TINYINT(1)   | æ˜¯å¦å¯ç”¨                         |
| created_at | DATETIME     | åˆ›å»ºæ—¶é—´                         |

> ç®¡ç†é™æ€èŒè´£åˆ†ç¦»ï¼ˆSSDï¼‰å’ŒåŠ¨æ€èŒè´£åˆ†ç¦»ï¼ˆDSDï¼‰è§„åˆ™([CiteSeerX](https://citeseerx.ist.psu.edu/document?doi=6a3fb007d33744dfd6a386efe556bbd018f99667&repid=rep1&type=pdf&utm_source=chatgpt.com), [åšå®¢å›­](https://www.cnblogs.com/BNTang/articles/17024549.html?utm_source=chatgpt.com))ã€‚

------

## 4ï¸âƒ£ å®¡è®¡ä¸æ—¥å¿—è¡¨

### 4.1 `AuditLog` æ“ä½œå®¡è®¡è¡¨

| å­—æ®µ        | ç±»å‹         | è¯´æ˜                                            |
| ----------- | ------------ | ----------------------------------------------- |
| log_id      | BIGINT PK    | æ—¥å¿—å”¯ä¸€æ ‡è¯†                                    |
| user_id     | BIGINT FK    | æ“ä½œè€… ID                                       |
| action      | VARCHAR(100) | æ“ä½œç±»å‹ï¼ˆå¦‚ `AssignRole`, `RevokePermission`ï¼‰ |
| target_type | VARCHAR(50)  | ç›®æ ‡ç±»å‹ï¼ˆ`User`/`Role`/`Permission`ï¼‰          |
| target_id   | BIGINT       | ç›®æ ‡å¯¹è±¡ ID                                     |
| timestamp   | DATETIME     | æ“ä½œæ—¶é—´                                        |
| details     | JSON         | æ“ä½œè¯¦æƒ…                                        |

> è®°å½•æ‰€æœ‰å…³é”®å˜æ›´æ“ä½œï¼Œæ”¯æŒåˆè§„å®¡è®¡([Reddit](https://www.reddit.com/r/PostgreSQL/comments/t7fcvp/database_design_for_access_control/?utm_source=chatgpt.com))ã€‚

### 4.2 `SessionLog` ä¼šè¯æ—¥å¿—è¡¨

| å­—æ®µ       | ç±»å‹        | è¯´æ˜                                      |
| ---------- | ----------- | ----------------------------------------- |
| entry_id   | BIGINT PK   | æ—¥å¿—å”¯ä¸€æ ‡è¯†                              |
| session_id | CHAR(36)    | å…³è” `Session.session_id`                 |
| event_type | VARCHAR(50) | äº‹ä»¶ç±»å‹ï¼ˆ`Start`/`End`/`RoleActivated`ï¼‰ |
| event_time | DATETIME    | äº‹ä»¶æ—¶é—´                                  |
| metadata   | JSON        | æ‰©å±•ä¿¡æ¯                                  |

> è¯¦ç»†è®°å½•ä¼šè¯ç”Ÿå‘½å‘¨æœŸå’Œè§’è‰²æ¿€æ´»äº‹ä»¶ï¼ŒåŠ©åŠ›å®‰å…¨åˆ†æ([CSDN](https://blog.csdn.net/csucsgoat/article/details/116906638?utm_source=chatgpt.com))ã€‚

------

## ğŸŒŸ è®¾è®¡è¦ç‚¹

- **ä¸»é”®**ï¼šæ¨èä½¿ç”¨é›ªèŠ± ID æˆ– UUIDï¼Œä¿éšœåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å”¯ä¸€æ€§([CiteSeerX](https://citeseerx.ist.psu.edu/document?doi=6a3fb007d33744dfd6a386efe556bbd018f99667&repid=rep1&type=pdf&utm_source=chatgpt.com))ã€‚
- **å¤–é”®çº¦æŸ**ï¼šä¿è¯å¼•ç”¨å®Œæ•´æ€§ï¼›å…³è”è¡¨å‡åº”å»ºç«‹è”åˆå”¯ä¸€ç´¢å¼•ï¼Œé˜²æ­¢é‡å¤æ˜ å°„ã€‚
- **æ—¶é—´å­—æ®µ**ï¼šæ‰€æœ‰è¡¨å‡å¸¦ `created_at`/`updated_at`ï¼Œä¾¿äºå®¡è®¡ä¸å›æº¯ã€‚
- **JSON å­˜å‚¨**ï¼šåœ¨ `ConstraintRule.parameters`ã€`AuditLog.details`ã€`SessionLog.metadata` ç­‰å­—æ®µä½¿ç”¨ JSONï¼Œä»¥æé«˜è§„åˆ™åŠæ—¥å¿—çš„çµæ´»æ€§ã€‚
- **ç´¢å¼•**ï¼šå¯¹é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼ˆå¦‚ `user_id`ã€`role_id`ã€`session_id`ï¼‰å»ºç´¢å¼•ï¼Œæå‡æ€§èƒ½ã€‚

é€šè¿‡ä¸Šè¿°è¡¨è®¾è®¡ï¼ŒRBAC ç³»ç»Ÿå®ç°äº†ä»åŸºç¡€æˆæƒåˆ°åŠ¨æ€èŒè´£åˆ†ç¦»ã€å®¡è®¡æ—¥å¿—ç­‰å®Œæ•´åŠŸèƒ½ï¼Œæ»¡è¶³ä¼ä¸šçº§å®‰å…¨ä¸åˆè§„éœ€æ±‚ã€‚
