# XiHan.BasicApp.Rbac æ¨¡å—

> **æ ‡å‡† RBAC + æ‰©å±•èƒ½åŠ›ï¼ˆè§’è‰²ç»§æ‰¿ã€DSDã€SSD çº¦æŸè§„åˆ™ï¼‰**  
> **ç‰ˆæœ¬**ï¼šv2.0  
> **æœ€åæ›´æ–°**ï¼š2026-01-07

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… æ ‡å‡† RBAC æ¨¡å‹

- âœ… **èµ„æºï¼ˆResourceï¼‰**ï¼šç»Ÿä¸€æŠ½è±¡æ‰€æœ‰å¯æˆæƒèµ„æº
- âœ… **æ“ä½œï¼ˆOperationï¼‰**ï¼šå®šä¹‰å¯¹èµ„æºçš„æ“ä½œç±»å‹
- âœ… **æƒé™ï¼ˆPermissionï¼‰**ï¼šæƒé™ = èµ„æº + æ“ä½œ
- âœ… **è§’è‰²ï¼ˆRoleï¼‰**ï¼šæƒé™çš„é›†åˆ
- âœ… **ç”¨æˆ·ï¼ˆUserï¼‰**ï¼šé€šè¿‡è§’è‰²è·å¾—æƒé™

### âœ… æ‰©å±•èƒ½åŠ›

- âœ… **è§’è‰²ç»§æ‰¿ï¼ˆRole Hierarchyï¼‰**ï¼šæ”¯æŒå¤šç»§æ‰¿ï¼Œå­è§’è‰²ç»§æ‰¿çˆ¶è§’è‰²æƒé™
- âœ… **ä¼šè¯è§’è‰²ï¼ˆSession Roleï¼‰**ï¼šæ”¯æŒåŠ¨æ€èŒè´£åˆ†ç¦»ï¼ˆDSDï¼‰
- âœ… **çº¦æŸè§„åˆ™ï¼ˆConstraint Ruleï¼‰**ï¼šæ”¯æŒ SSD/DSD/äº’æ–¥/åŸºæ•°ç­‰çº¦æŸ
- âœ… **æ•°æ®æƒé™ï¼ˆData Permissionï¼‰**ï¼šæŒ‰éƒ¨é—¨/ç”¨æˆ·è¿‡æ»¤æ•°æ®
- âœ… **å¤šç§Ÿæˆ·ï¼ˆMulti-Tenantï¼‰**ï¼šç§Ÿæˆ·çº§æ•°æ®éš”ç¦»

---

## ğŸ“Š å®ä½“æ€»è§ˆ

### æ ¸å¿ƒå®ä½“ï¼ˆ9 ä¸ªï¼‰

| å®ä½“                | è¯´æ˜                           | è¡¨å                  |
| ------------------- | ------------------------------ | --------------------- |
| `SysResource`       | èµ„æºè¡¨                         | `Sys_Resource`        |
| `SysOperation`      | æ“ä½œè¡¨                         | `Sys_Operation`       |
| `SysPermission`     | æƒé™è¡¨ï¼ˆResource + Operationï¼‰ | `Sys_Permission`      |
| `SysRole`           | è§’è‰²è¡¨                         | `Sys_Role`            |
| `SysUser`           | ç”¨æˆ·è¡¨                         | `Sys_User`            |
| `SysUserRole`       | ç”¨æˆ·è§’è‰²å…³è”                   | `Sys_User_Role`       |
| `SysRolePermission` | è§’è‰²æƒé™å…³è”                   | `Sys_Role_Permission` |
| `SysUserPermission` | ç”¨æˆ·æƒé™å…³è”ï¼ˆGrant/Denyï¼‰     | `Sys_User_Permission` |
| `SysMenu`           | èœå•è¡¨                         | `Sys_Menu`            |

### æ‰©å±•å®ä½“ï¼ˆ3 ä¸ªï¼‰

| å®ä½“                | è¯´æ˜         | è¡¨å                  |
| ------------------- | ------------ | --------------------- |
| `SysRoleHierarchy`  | è§’è‰²ç»§æ‰¿å…³ç³» | `Sys_Role_Hierarchy`  |
| `SysSessionRole`    | ä¼šè¯è§’è‰²æ˜ å°„ | `Sys_Session_Role`    |
| `SysConstraintRule` | çº¦æŸè§„åˆ™     | `Sys_Constraint_Rule` |

### è¾…åŠ©å®ä½“ï¼ˆ6 ä¸ªï¼‰

| å®ä½“                | è¯´æ˜             | è¡¨å                  |
| ------------------- | ---------------- | --------------------- |
| `SysDepartment`     | éƒ¨é—¨è¡¨           | `Sys_Department`      |
| `SysUserDepartment` | ç”¨æˆ·éƒ¨é—¨å…³è”     | `Sys_User_Department` |
| `SysRoleDataScope`  | è§’è‰²æ•°æ®æƒé™èŒƒå›´ | `Sys_Role_DataScope`  |
| `SysTenant`         | ç§Ÿæˆ·è¡¨           | `Sys_Tenant`          |
| `SysUserSession`    | ç”¨æˆ·ä¼šè¯         | `Sys_User_Session`    |
| `SysUserSecurity`   | ç”¨æˆ·å®‰å…¨         | `Sys_User_Security`   |

---

## ğŸ”¥ æ ¸å¿ƒå…¬å¼

```
æƒé™ï¼ˆPermissionï¼‰ = èµ„æºï¼ˆResourceï¼‰ + æ“ä½œï¼ˆOperationï¼‰
```

**ç¤ºä¾‹**ï¼š

```
user:create = ç”¨æˆ·èµ„æº + åˆ›å»ºæ“ä½œ
order:view  = è®¢å•èµ„æº + æŸ¥çœ‹æ“ä½œ
```

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£                                        | è¯´æ˜                                   |
| ------------------------------------------- | -------------------------------------- |
| [å®Œæ•´æŒ‡å—](./RBAC_COMPLETE_GUIDE.md)        | æ ¸å¿ƒæ¦‚å¿µã€å®ä½“è®¾è®¡ã€ä½¿ç”¨åœºæ™¯ã€æœ€ä½³å®è·µ |
| [ç§å­æ•°æ®ç¤ºä¾‹](./SEED_DATA_EXAMPLE.md)      | å®Œæ•´çš„åˆå§‹åŒ–æ•°æ®ç¤ºä¾‹                   |
| [æ¶æ„è®¾è®¡](./ARCHITECTURE.md)               | æ¨¡å—æ¶æ„ã€é¢†åŸŸè®¾è®¡ã€é€‚é…å™¨æ¨¡å¼         |
| [æ•°æ®åº“è®¾è®¡](../docs/5.æ ¸å¿ƒæ•°æ®åº“è¡¨è®¾è®¡.md) | æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡                       |
| [å¼€å‘è®¡åˆ’](../docs/2.DevelopmentPlan.md)    | Sprint è¿­ä»£è®¡åˆ’                        |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®ä½“å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resource â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚Permissionâ”‚â—€â”€â”€â”€â”€â”€â”€â”‚  Operation   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ N
                        â”‚
                        â”‚ M
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                   â”‚   Role   â”‚
                   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â”‚ N
                        â”‚
                        â”‚ M
                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                   â”‚   User   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æƒé™åˆ¤æ–­æµç¨‹

```
1. è·å–ç”¨æˆ·è§’è‰² â†’ 2. è·å–è§’è‰²æƒé™ â†’ 3. åˆå¹¶ç”¨æˆ·ç›´æ¥æƒé™
   â†“
4. æ£€æŸ¥çº¦æŸè§„åˆ™ â†’ 5. è¿”å›æœ€ç»ˆæƒé™
```

### 3. ç¤ºä¾‹ä»£ç 

```csharp
// 1. åˆ›å»ºèµ„æº
var resource = new SysResource
{
    ResourceCode = "user",
    ResourceName = "ç”¨æˆ·ç®¡ç†",
    ResourceType = ResourceType.Menu
};

// 2. åˆ›å»ºæ“ä½œ
var operation = new SysOperation
{
    OperationCode = "create",
    OperationName = "åˆ›å»º",
    OperationTypeCode = OperationTypeCode.Create
};

// 3. åˆ›å»ºæƒé™
var permission = new SysPermission
{
    ResourceId = resource.BasicId,
    OperationId = operation.BasicId,
    PermissionCode = "user:create",
    PermissionName = "åˆ›å»ºç”¨æˆ·"
};

// 4. åˆ›å»ºè§’è‰²å¹¶åˆ†é…æƒé™
var role = new SysRole
{
    RoleCode = "admin",
    RoleName = "ç®¡ç†å‘˜"
};
await roleService.GrantPermissionAsync(role.BasicId, permission.BasicId);

// 5. åˆ†é…è§’è‰²ç»™ç”¨æˆ·
await userService.AssignRoleAsync(userId, role.BasicId);

// 6. æƒé™æ£€æŸ¥
bool hasPermission = await permissionService.HasPermissionAsync(userId, "user:create");
```

---

## âœ¨ æ–°è®¾è®¡äº®ç‚¹

### ğŸ¯ å®Œå…¨æ ‡å‡†åŒ–

- âœ… **ç§»é™¤å…¼å®¹å­—æ®µ**ï¼šä¸å†å…¼å®¹æ—§ç‰ˆæœ¬ï¼Œå®Œå…¨é‡‡ç”¨ Resource + Operation æ¨¡å‹
- âœ… **å¼ºåˆ¶å…³è”**ï¼š`ResourceId` å’Œ `OperationId` å¿…å¡«ï¼Œç¡®ä¿æƒé™å®Œæ•´æ€§
- âœ… **ç»Ÿä¸€èµ„æº**ï¼šæ‰€æœ‰å¯æˆæƒå¯¹è±¡ç»Ÿä¸€ä¸º `SysResource`

### ğŸ—ï¸ æ¶æ„ä¼˜åŒ–

- âœ… **èœå•åˆ†ç¦»**ï¼š`SysMenu` ä¸“æ³¨å‰ç«¯é…ç½®ï¼Œ`SysResource` ä¸“æ³¨æƒé™æ§åˆ¶
- âœ… **åå‘å…³è”**ï¼š`SysMenu.ResourceId` â†’ `SysResource`ï¼Œä¸€ä¸ªèµ„æºå¯è¢«å¤šä¸ªèœå•å¼•ç”¨
- âœ… **å¯¼èˆªå±æ€§å®Œå–„**ï¼šæ‰€æœ‰å®ä½“éƒ½æœ‰å®Œæ•´çš„ SqlSugar å¯¼èˆªå±æ€§

### ğŸ”’ å®‰å…¨å¢å¼º

- âœ… **çº¦æŸè§„åˆ™**ï¼šæ”¯æŒ SSD/DSD/äº’æ–¥/åŸºæ•°/å…ˆå†³æ¡ä»¶ç­‰çº¦æŸ
- âœ… **å®¡è®¡æ”¯æŒ**ï¼š`Permission.RequireAudit` æ ‡è®°éœ€è¦å®¡è®¡çš„æƒé™
- âœ… **ä¼˜å…ˆçº§æ§åˆ¶**ï¼š`Permission.Priority` æ”¯æŒæƒé™å†²çªæ—¶çš„å†³ç­–

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **å®ä½“æ€»æ•°**ï¼š38 ä¸ª
- **æ ¸å¿ƒå®ä½“**ï¼š9 ä¸ª
- **æ‰©å±•å®ä½“**ï¼š3 ä¸ª
- **è¾…åŠ©å®ä½“**ï¼š6 ä¸ª
- **å…³è”è¡¨**ï¼š3 ä¸ª
- **æ—¥å¿—è¡¨**ï¼š6 ä¸ª
- **å…¶ä»–è¡¨**ï¼š11 ä¸ª

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](../../../../LICENSE) å¼€æºåè®®ã€‚

---

**å¼€å‘å›¢é˜Ÿ**ï¼šXiHan Development Team  
**æŠ€æœ¯æ”¯æŒ**ï¼š[GitHub Issues](https://github.com/YourOrg/XiHanFun/issues)
